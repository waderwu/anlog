<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Dashboard Template for Bootstrap</title>

    {% load static from staticfiles %}
    <link rel="icon" href="{% static "images/favicon.ico" %}">
    <link href="{% static "styles/bootstrap.css" %}" rel="stylesheet">
    <link href="{% static "styles/dashboard.css" %}" rel="stylesheet">
  </head>

  <body>
    <header>
      <!-- Fixed navbar -->
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <span class="navbar-brand">Web Log Analyser</span>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="/log/">Home</a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="/log/show">List<span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link disabled" href="#">Disabled</a>
            </li>
          </ul>
          <form class="form-inline mt-2 mt-md-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
          </form>
        </div>
      </nav>
  </header>

    <div class="container-fluid">
      <div class="row">
        <main role="main" class="col-md-12 ml-sm-auto px-4">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Dashboard</h1>
{#            <div class="btn-toolbar mb-2 mb-md-0">#}
{#              <div class="btn-group mr-2">#}
{#                <button class="btn btn-sm btn-outline-secondary">Share</button>#}
{#                <button class="btn btn-sm btn-outline-secondary">Export</button>#}
{#              </div>#}
{#              <button class="btn btn-sm btn-outline-secondary dropdown-toggle">#}
{#                <span data-feather="calendar"></span>#}
{#                This week#}
{#              </button>#}
{#            </div>#}
          </div>
          <form class="form-inline mt-2 mb-2" action="/log/search/" method="get">
            <button class="btn btn-sm btn-outline-secondary ml-1 condition" value="keyword" type="button">Keyword</button>
            <input class="form-control form-control-sm col-md-1 ml-1" type="text" name="keyword">
            <button class="btn btn-sm btn-outline-secondary ml-1 condition" value="ip" type="button">IP Address</button>
            <input class="form-control form-control-sm col-md-1 ml-1" type="text" name="ip">
            <button class="btn btn-sm btn-outline-secondary ml-1 condition" value="method" type="button">Method</button>
            <input class="form-control form-control-sm col-md-1 ml-1" type="text" name="method">
            <button class="btn btn-sm btn-outline-secondary ml-1 condition" value="post" type="button">Post</button>
            <input class="form-control form-control-sm col-md-1 ml-1" type="text" name="post">
            <button class="btn btn-sm btn-outline-secondary ml-1 condition" value="get" type="button">Get</button>
            <input class="form-control form-control-sm col-md-1 ml-1" type="text" name="get">
            <button class="btn btn-sm btn-outline-success ml-1" type="submit">Search</button>
          </form>

          <div id="code">

          </div>

          <table id="loglist" class="table" style="width:100%">
                <thead class="thead-dark">
                    <tr class="basic_attr">
                        <th><input type="checkbox" id="checkAll" name="checkAll" /></th>
                        <th>Time</th>
                        <th>IP</th>
                        <th>Method</th>
                        <th>Path</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                        {% for item in contents %}
                            <tr class="details_control" onclick="showDetail({{ item.index }})">
                                <th><input type="checkbox" name="checkItem" /></th>
                                <td>{{ item.attacktime }}</td>
                                <td>{{ item.attackip }}</td>
                                <td style="text-transform:uppercase;">{{ item.method }}</td>
                                <td>{{ item.path }}</td>
                                <td>{{ item.attacktype }}</td>
                            </tr>
					        <tr class="details detail_{{ item.index }}">
                                <td colspan="6">
                                <table cellpadding="6" style="table-layout:fixed;width:100%">
                                <tr>
                                    <td style="width:10%">Headers:</td>
                                    <td style="width:90%;word-wrap:break-word;word-break:break-all;"><code>{{ item.headers }}</code></td>
                                </tr>
                                <tr>
                                    <td>Post:</td>
                                    <td>{{ item.post }}</td>
                                </tr>
                                <tr>
                                    <td>Get:</td>
                                    <td>{{ item.get }}</td>
                                </tr>
                                <tr>
                                    <td>Response:</td>
                                    <td>
                                        <div style="overflow-y:auto;height:200px;word-break:break-all">
                                            <pre>
                                                <code class="response">
                                                {{ item.response }}
                                                </code>
                                            </pre>
                                        </div>
                                    </td>
                                </tr>
                                </table>
                                </td>
                            </tr>
                        {% endfor %}
                </tbody>
            </table>

        </main>
      </div>
    </div>

    <nav class="navbar fixed-bottom navbar-light bg-light">
{#        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">#}
{#            <h1 class="h2">Dashboard</h1>#}
{#            <div class="btn-toolbar mb-2 mb-md-0">#}
{#              <div class="btn-group mr-2">#}
{#                <button class="btn btn-sm btn-outline-secondary">Share</button>#}
{#                <button class="btn btn-sm btn-outline-secondary">Export</button>#}
{#              </div>#}
{#              <button class="btn btn-sm btn-outline-secondary dropdown-toggle">#}
{#                <span data-feather="calendar"></span>#}
{#                This week#}
{#              </button>#}
{#            </div>#}
{#          </div>#}
                <div class="btn-group pagination">
                {% if page_info.has_previous %}
                    <button class="btn btn-sm btn-outline-secondary"><a href="?page={{ page_info.previous_page_number }}">Previous</a></button>
                {% else %}
                    <button class="btn btn-sm btn-outline-secondary disabled"><a>Previous</a></button>
                {% endif %}
                    <button class="btn btn-sm btn-outline-secondary disabled">Page {{ page_info.number }} of {{ page_info.num_pages }}</button>
                {% if page_info.has_next %}
                    <button class="btn btn-sm btn-outline-secondary"><a href="?page={{ page_info.next_page_number }}">Next</a></button>
                {% else %}
                    <button class="btn btn-sm btn-outline-secondary disabled"><a>Next</a></button>
                {% endif %}
                </div>
                <input class="text" type="text" name="page_jump">
                <button class="btn btn-sm btn-outline-secondary" id="page_jump" type="button">Jump</button>
                <button class="btn btn-sm btn-outline-success" id="replay" type="submit">Script Produce</button>
    </nav>

    <script src="{% static "scripts/jquery-3.3.1.js" %}"></script>
    <script src="{% static "scripts/popper.min.js" %}"></script>
    <script src="{% static "scripts/bootstrap.js" %}"></script>
    <script src="{% static "scripts/multiselect.js" %}"></script>
{#    <script src="{% static "scripts/jquery.dataTables.min.js" %}"></script>#}
{#    <script src="{% static "scripts/dataTables.select.min.js" %}"></script>#}
{#    <script src="{% static "scripts/dataTables.buttons.min.js" %}"></script>#}

    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
    <script>
      feather.replace()
    </script>
    <!-- Datatables Config -->
    <script>
        function showDetail(index){
            $(".detail_"+index).toggle();
        }
    </script>

    <script>
        $(document).ready(function(){
            $(".details").hide();
        });
    </script>

    <script>
        $(".condition").click(function () {
            var $input = $("input[name='" + $(this).attr("value") + "']");
            if ($input.attr("disabled") === undefined) {
                $input.attr("disabled", "disabled");
            } else {
                $input.removeAttr("disabled");
            }
        });
    </script>

    <script>
        $("#page_jump").click(function(){
            window.location.href="/log/show?page="+$("input[name='page_jump'] ").val();
        });
    </script>

    <script>
        $("#replay").click(function() {
            var $res = $(".selected").next();
            var ids = [];
            $res.each(function(i){
                ids[i]=$(this).attr("class").split(' ')[1].substring(7);
            });
            if (ids.length !== 0){
                $.ajax({
                    url:"/log/replay/",
                    type: "get",
                    data: {
                        "id": ids
                    },
                    success:function($result)
                    {
                       $("#code").html("<pre><code>"+$result+"<code></pre>");
                    },
                    error: function () {
                        alert("Sorry, fail to produce replay script");
                    }
                });
            }
        })
    </script>


  </body>
</html>
